<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
	integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	crossorigin="anonymous">
</head>
<body>
<div class="container">

	<h1>OCR🍅</h1>

	<div id="div1">
		<button type="button" id="restore" class="btn btn-primary">カメラ起動</button>
	</div><!-- div1 -->

	<div class="collapse" id="div3">
		<div id="address"></div>
		<button type="button" id="send_tomato" class="btn btn-primary">送信</button>
		<div id="result">
			<ul></ul>
		</div>
	</div><!-- div3 -->
</div>

<!-- スキャンモーダル -->
<div class="modal fade" id="modal-qrscan" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel2">OCRスキャン</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="閉じる">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<label id="modal-label"></label>

				<div class="input-group">
					<label class="input-group-btn mr-1">
						<span class="btn btn-primary">
							画像でスキャン<input id="file_image" type="file" style="display:none">
						</span>
					</label>
				</div>
				<canvas id="canvas"  width="100%" hidden></canvas>
				<!-- canvas id="canvas2"  width="100%"></canvas -->
				<button type="button" id="button_snap" class="btn btn-primary">
					スナップ
				</button>
				<button type="button" id="button_reset" class="btn btn-primary">
					リセット
				</button>
				<div id="scan_data" class="text-break"></div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">キャンセル</button>
				<button type="button" class="btn btn-primary" data-dismiss="modal"	id="modal_ok">OK</button>

			</div><!-- /.modal-footer -->
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript" src="https://unpkg.com/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
	integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
	crossorigin="anonymous">
</script>
<script src="symbol-sdk-pack-1.0.1.js"></script>
<script src="https://xembook.github.io/xembook/xembook_config.js"></script>

<script>

const _0x424b33=_0x2887;function _0x11fa(){const _0x367a88=['x2LTyq','ig9UyW','DhLWzq','lNn5Bq','qwrKCG','DgfIxW','mue0ma','BK1LCW','vwLUDa','Ahr0Ca','oeeXna','44k544kT44oJ44oZ','z2v0vq','BLbHDa','mtuWmte1sMTiDKXK','D0fKza','C2vYtq','CNLgyq','Bwf0BW','44oP44o844gN56k6','l3rYyq','ywDL','Aw1HzW','utjbqG','CMvZCW','qJu4','zxnZ','Bw9Kyq','C2fNzq','rtG0nW','DgvfBa','B250zq','44ks44kI44od44ox','rgvHza','Aw5L','Aw5HDa','Aw9U','yM9VAW','EwXL','B0HLAq','i3jLCW','Aw5PDa','n01PuKnODW','Dgvoyq','CY9YEa','iJ7JGQJJGQ8','AgfZAa','DMLKzq','nZGXmeTtu29wwq','Bg9Zzq','CMvWBa','Aw5JBa','yMvNAq','ndu4rq','qZG0oa','BgLKuG','AgLKzq','l25Vza','mtK2otuYmdn0y1DKyKS','lM5LDa','zf90BW','CMvZzq','DMfS','ywWTCq','Dgv4Da','s1vpvq','zwrPyq','zv9PBq','44oZ44gR5AsX5Pwx','Dg9UxW','zw1LBG','yurLDG','r0HjsG','z2v0qW','DhrYAq','sLfcnW','pgeGDa','zhvSzq','i2j1Da','zMXVBW','Dg9YCW','yw5Zyq','ugXHAq','DwfNzq','CgXHEq','mta0vgvus1LQ','rdvgmW','Bfn0CG','mdrdra','44kI44oj44oS44k5','rtuZoq','CMvHza','ywjLBa','44gU44k544kT44oJ','nujcsa','BLjLCa','C2v0ua','sefwrq','ntj2uvLvAvu','i21Vza','ndyYqq','ywWTyW','rgf0yq','yxbWzq','C2XPyW','DgfvuG','mJa3mG','C3jJ','BwvKAq','i2fKza','C3rYBW','C2HVDW','yxjNzq','v1zj','BNrcEq','z2v0sq','CMTLCG','44ov44kH44kK44oR','Esborq','A2v5CW','CNnJyq','CgvYyq','zxrLCG','DgvxBW','mJq1mtnUue5LvMG','t1bruG','zgLZyq','C2LNBG','Aw5Uzq','B3jLCG','qJzbrq','rdLgmq','B3nPDa','tgfUzW','Dd0IxW','Bwf0Aq','zuTLEq','tufjtG','tMv0DW','DgvuCG','qJveoa','x0votW','44glue5h','y29UyW','nZC2qW','Bg9N','yxbZzq','y2XLyq','CLrLEa','y2HHBG','y3rPBW','44og44kT44k544oi','C3vICW','uLLkwa','qJjenG','44gx44gM44gp44gG','qwnJBW','oemWnW','B25SBW','ChjVCa','Bwf0yW','Axnwyq','pJWVBa','mZeWmW','i2zPBa','lNHLBq','z2H0','ywnLuG','y3jLyq','AwfSAq','zxbVCW','DxrMlq','BNnHyW','u1Desa','ywnO','44gx44g+44gx44gF','44gv44ge44cc','zs9WBG','BwfNzq','CY9ZEq','D2vIuW','z2v0rq','iMH0Da','zwfT','BMeH','ig9Wzq','ntu2mZe3zxPJDgDU','vuLUDa','refuqq','zNjVBq','mtbhsMnhyMG','Bw92zq','B3bLBG','nJeXnZaZmffNrMrprq','Dg9Yzq','DgLVBG','yMXLza','reiWna','Bg9Jyq','Bg9Hza','C2v0qq','zxHWBa','6kQnpc9H','mZKZrG','DgHLBG','zhjHDW','ChvZAa','CLjLyW','z25PEG','uMvWBW','B1DPza','mJm0nq','yxHgzq','DgvYBq','sw1HzW','mdi2qW','nvPwuq','v1HzwG','yNv0zq','y2fUDG','CMfJAW','C3rVCa','ywnL','vhjHBG','Dw50','meqXqG','yM9SyG','tsbuBW','AxrVCG','lMjZlG','mefbmG','C25HCa','ExbL','ntu4oa','x05fva','C2zLCG','BgvTzq','mZi5mq','qurbrq','zhjLCW','z2v0va','tw9Zyq','B25JBa','yxDbza','x2rHDa','AgLKza','sLbfrW','tKq3tq','AgvPzW','lM1Vza','i0zgmW','ntm4odqWmhnmDK5ssG','D2LKDa','BgvUzW','44gx44gM5lIl44gv','zw5LCG','BgLUzq','BgLZDa','rKzdnW','n0reqG','AxzHDa','B21syq','CZOVlW','BwjVBa','zw52Aq','C2fJDa','zw5N','y2XPyW','ANmVBW','yxjHBq','CdOVlW','BI5PBW','B2nRzq','44k544ox44oT44o8','C3bSAq','ywWTBa','zMLSzq','B3jRva','sgfWCa','DwrLCW','zv9TBW','AYiGAa','AwnLCW'];_0x11fa=function(){return _0x367a88;};return _0x11fa();}(function(_0x118c56,_0x38e9d5){const _0x38757f=_0x2887,_0x581106=_0x118c56();while(!![]){try{const _0x4c80ca=parseInt(_0x38757f(0x255))/0x1+parseInt(_0x38757f(0x287))/0x2*(-parseInt(_0x38757f(0x2a1))/0x3)+-parseInt(_0x38757f(0x27a))/0x4*(-parseInt(_0x38757f(0x233))/0x5)+parseInt(_0x38757f(0x1cb))/0x6*(-parseInt(_0x38757f(0x24f))/0x7)+-parseInt(_0x38757f(0x205))/0x8+-parseInt(_0x38757f(0x1c4))/0x9+-parseInt(_0x38757f(0x1c8))/0xa*(-parseInt(_0x38757f(0x25f))/0xb);if(_0x4c80ca===_0x38e9d5)break;else _0x581106['push'](_0x581106['shift']());}catch(_0x285928){_0x581106['push'](_0x581106['shift']());}}}(_0x11fa,0x954ef));var currentTab,scanData=document[_0x424b33(0x1bf)+_0x424b33(0x1f6)+'ntBy'+'Id']('scan'+_0x424b33(0x1fe)+'a');ocrFrameDiv=0x7,ocrFrameDivTop=Math[_0x424b33(0x274)+'r'](ocrFrameDiv/0x2)/ocrFrameDiv,ocrFrameDivBottom=(Math[_0x424b33(0x274)+'r'](ocrFrameDiv/0x2)+0x1)/ocrFrameDiv,$('#but'+_0x424b33(0x26a)+_0x424b33(0x262)+'t')['prop']('disa'+_0x424b33(0x1ce),!![]),$('#res'+_0x424b33(0x1cc))[_0x424b33(0x215)+'k'](function(){const _0x1272ab=_0x424b33;currentTab=_0x1272ab(0x22a),$(_0x1272ab(0x288)+_0x1272ab(0x21d)+_0x1272ab(0x281))[_0x1272ab(0x265)](_0x1272ab(0x2bc)+'を赤枠内'+'に入れて'+_0x1272ab(0x230)+_0x1272ab(0x2c0)+_0x1272ab(0x1ba)),$('#div'+'-ns')['coll'+_0x1272ab(0x2b7)]('hide'),$('#mod'+_0x1272ab(0x264)+_0x1272ab(0x29d)+'n')[_0x1272ab(0x240)+'l']('show'),startVideo();}),$('#mod'+_0x424b33(0x264)+_0x424b33(0x29d)+'n')['on'](_0x424b33(0x25d)+_0x424b33(0x1ef)+_0x424b33(0x240)+'l',function(_0xf9fcc1){const _0x3ec18c=_0x424b33;stopVideo(),clearRect(),$(_0x3ec18c(0x2c9)+_0x3ec18c(0x268)+'age')[_0x3ec18c(0x263)]('');}),$('#mod'+'al_o'+'k')[_0x424b33(0x215)+'k'](async function(){const _0x432e31=_0x424b33;if(currentTab==_0x432e31(0x22a)+'tran'+_0x432e31(0x1f5)){}else currentTab==_0x432e31(0x22a)&&($(_0x432e31(0x292)+_0x432e31(0x23d))['text'](scanData['inne'+_0x432e31(0x2b9)+'t']),$('#div'+'3')[_0x432e31(0x294)](),scanData[_0x432e31(0x2a5)+_0x432e31(0x2b9)+'t']='');}),$(_0x424b33(0x2c9)+_0x424b33(0x268)+_0x424b33(0x23a))[_0x424b33(0x2ba)+'ge'](function(_0x2045ee){const _0x417d4e=_0x424b33;scanFileImage('file'+_0x417d4e(0x225)+'ge');}),$(_0x424b33(0x273)+_0x424b33(0x26a)+_0x424b33(0x1f1))[_0x424b33(0x215)+'k'](function(){const _0x2fa0d7=_0x424b33;isMovieScanning=![],scale=0x2,canvas2=document[_0x2fa0d7(0x2cd)+_0x2fa0d7(0x243)+_0x2fa0d7(0x26b)+'t'](_0x2fa0d7(0x1e5)+'as'),canvas2[_0x2fa0d7(0x206)+'h']=canvasElement[_0x2fa0d7(0x206)+'h']*scale,canvas2[_0x2fa0d7(0x202)+'ht']=canvasElement[_0x2fa0d7(0x202)+'ht']/ocrFrameDiv*scale,ctx2=canvas2[_0x2fa0d7(0x26e)+'onte'+'xt']('2d'),ctx2['draw'+_0x2fa0d7(0x1e0)+'e'](canvasElement,0x0,canvasElement['heig'+'ht']*ocrFrameDivTop,canvasElement['widt'+'h'],canvasElement[_0x2fa0d7(0x202)+'ht']/ocrFrameDiv,0x0,0x0,canvasElement[_0x2fa0d7(0x206)+'h']*scale,canvasElement[_0x2fa0d7(0x202)+'ht']/ocrFrameDiv*scale);const _0x419a58=Tesseract[_0x2fa0d7(0x2cd)+_0x2fa0d7(0x2a0)+_0x2fa0d7(0x299)]();(async()=>{const _0x39493f=_0x2fa0d7;await _0x419a58[_0x39493f(0x1d1)](),await _0x419a58[_0x39493f(0x1d1)+_0x39493f(0x2aa)+_0x39493f(0x278)](_0x39493f(0x214)),await _0x419a58[_0x39493f(0x24e)+_0x39493f(0x2ce)+'ze'](_0x39493f(0x214)),await _0x419a58[_0x39493f(0x285)+_0x39493f(0x217)+_0x39493f(0x29f)+'s']({'tessedit_char_whitelist':_0x39493f(0x1dd)+'67AB'+'CDEF'+_0x39493f(0x26d)+'KLMN'+_0x39493f(0x2a2)+'STUV'+_0x39493f(0x1e3)+'-'});const {data:{text:_0xda6313}}=await _0x419a58['reco'+_0x39493f(0x1da)+'e'](canvas2);var _0x238dbe=_0xda6313[_0x39493f(0x2c5)+'h'](/N[0-Z]{5}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{2}[AIQY]/);validAddress='';if(_0x238dbe){splitedAddress=_0x238dbe[0x0][_0x39493f(0x21c)+'t'](/[S5]/),balls=[...Array(splitedAddress[_0x39493f(0x207)+'th']-0x1)[_0x39493f(0x29c)]()],nukitorisu=balls[_0x39493f(0x207)+'th']-0x1;for(ii=0x1;ii<balls['leng'+'th'];ii++){combi=kumiawase(balls,ii);for(i=0x0;i<combi[_0x39493f(0x207)+'th'];i++){builder='';for(j=0x0;j<splitedAddress['leng'+'th'];j++){builder=builder+splitedAddress[j],j!==splitedAddress['leng'+'th']-0x1&&(combi[i][_0x39493f(0x258)+_0x39493f(0x221)](j)?builder=builder+'S':builder=builder+'5');}console[_0x39493f(0x2b6)](builder),console[_0x39493f(0x2b6)](nem['Addr'+_0x39493f(0x23f)][_0x39493f(0x2c6)+_0x39493f(0x25c)+_0x39493f(0x1fd)+_0x39493f(0x1f9)+'s'](builder[_0x39493f(0x257)+'ace'](/-/g,''))),nem[_0x39493f(0x229)+_0x39493f(0x23f)]['isVa'+_0x39493f(0x25c)+_0x39493f(0x1fd)+_0x39493f(0x1f9)+'s'](builder[_0x39493f(0x257)+_0x39493f(0x1e8)](/-/g,''))&&(validAddress=builder,scanData[_0x39493f(0x2a5)+'rTex'+'t']=validAddress);}}validAddress===''&&alert(_0x39493f(0x27e)+_0x39493f(0x282)+_0x39493f(0x269)+_0x39493f(0x1b9)+'。'+_0x238dbe[0x0]),console['log'](_0xda6313),console[_0x39493f(0x2b6)](_0x238dbe);}else alert(_0x39493f(0x27e)+'のスキャ'+_0x39493f(0x269)+_0x39493f(0x1b9)+'。');$(_0x39493f(0x273)+_0x39493f(0x26a)+_0x39493f(0x262)+'t')[_0x39493f(0x2c4)](_0x39493f(0x2a3)+_0x39493f(0x1ce),![]),$(_0x39493f(0x273)+_0x39493f(0x26a)+_0x39493f(0x1f1))[_0x39493f(0x2c4)](_0x39493f(0x2a3)+_0x39493f(0x1ce),!![]),await _0x419a58[_0x39493f(0x1df)+_0x39493f(0x248)+'e']();})();});function kumiawase(_0x3120c7,_0x56622e){const _0x400125=_0x424b33;var _0x2a353e,_0x1caecf,_0x11d1a1,_0x62dffd,_0x2d5fa3;_0x2a353e=[],_0x62dffd=_0x3120c7[_0x400125(0x207)+'th'];if(_0x62dffd<_0x56622e)return;else{if(_0x56622e==0x1)for(_0x1caecf=0x0;_0x1caecf<_0x62dffd;_0x1caecf++){_0x2a353e[_0x1caecf]=[_0x3120c7[_0x1caecf]];}else for(_0x1caecf=0x0;_0x1caecf<_0x62dffd-_0x56622e+0x1;_0x1caecf++){_0x2d5fa3=kumiawase(_0x3120c7[_0x400125(0x28d)+'e'](_0x1caecf+0x1),_0x56622e-0x1);for(_0x11d1a1=0x0;_0x11d1a1<_0x2d5fa3['leng'+'th'];_0x11d1a1++){_0x2a353e[_0x400125(0x1d8)]([_0x3120c7[_0x1caecf]][_0x400125(0x2b4)+'at'](_0x2d5fa3[_0x11d1a1]));}}}return _0x2a353e;}$(_0x424b33(0x273)+'ton_'+_0x424b33(0x262)+'t')['clic'+'k'](function(){const _0x557642=_0x424b33;isMovieScanning=!![],scanData[_0x557642(0x2a5)+_0x557642(0x2b9)+'t']='',requestAnimationFrame(tick),$(_0x557642(0x273)+'ton_'+'snap')[_0x557642(0x2c4)](_0x557642(0x2a3)+_0x557642(0x1ce),![]),$(_0x557642(0x273)+_0x557642(0x26a)+_0x557642(0x262)+'t')['prop']('disa'+_0x557642(0x1ce),!![]);});function _0x2887(_0xcc00f1,_0x51aa35){const _0x11fabf=_0x11fa();return _0x2887=function(_0x288771,_0x5cb057){_0x288771=_0x288771-0x1b8;let _0x3a4ff0=_0x11fabf[_0x288771];if(_0x2887['VtIsIi']===undefined){var _0x9e86=function(_0xf9fcc1){const _0x2045ee='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x419a58='',_0xda6313='';for(let _0x238dbe=0x0,_0x3120c7,_0x56622e,_0x2a353e=0x0;_0x56622e=_0xf9fcc1['charAt'](_0x2a353e++);~_0x56622e&&(_0x3120c7=_0x238dbe%0x4?_0x3120c7*0x40+_0x56622e:_0x56622e,_0x238dbe++%0x4)?_0x419a58+=String['fromCharCode'](0xff&_0x3120c7>>(-0x2*_0x238dbe&0x6)):0x0){_0x56622e=_0x2045ee['indexOf'](_0x56622e);}for(let _0x1caecf=0x0,_0x11d1a1=_0x419a58['length'];_0x1caecf<_0x11d1a1;_0x1caecf++){_0xda6313+='%'+('00'+_0x419a58['charCodeAt'](_0x1caecf)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xda6313);};_0x2887['itfwue']=_0x9e86,_0xcc00f1=arguments,_0x2887['VtIsIi']=!![];}const _0x1f917f=_0x11fabf[0x0],_0x5ee33c=_0x288771+_0x1f917f,_0x3d75d0=_0xcc00f1[_0x5ee33c];return!_0x3d75d0?(_0x3a4ff0=_0x2887['itfwue'](_0x3a4ff0),_0xcc00f1[_0x5ee33c]=_0x3a4ff0):_0x3a4ff0=_0x3d75d0,_0x3a4ff0;},_0x2887(_0xcc00f1,_0x51aa35);}var canvasElement,canvas,isMovieScanning=![],video=document[_0x424b33(0x2cd)+_0x424b33(0x243)+_0x424b33(0x26b)+'t'](_0x424b33(0x254)+'o');function drawLine(_0x3b61da,_0x4a5eeb,_0x4e1081){const _0x897b7=_0x424b33;canvas[_0x897b7(0x259)+_0x897b7(0x232)+'h'](),canvas[_0x897b7(0x1c9)+'To'](_0x3b61da['x'],_0x3b61da['y']),canvas[_0x897b7(0x20a)+'To'](_0x4a5eeb['x'],_0x4a5eeb['y']),canvas[_0x897b7(0x20a)+'Widt'+'h']=0x4,canvas[_0x897b7(0x293)+'keSt'+_0x897b7(0x24b)]=_0x4e1081,canvas[_0x897b7(0x293)+'ke']();}function drawFrame(){const _0x5529ba=_0x424b33;drawLine({'x':0x0,'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivTop},{'x':canvasElement['widt'+'h'],'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivTop},_0x5529ba(0x204)+_0x5529ba(0x23e)),drawLine({'x':canvasElement['widt'+'h'],'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivTop},{'x':canvasElement[_0x5529ba(0x206)+'h'],'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivBottom},_0x5529ba(0x204)+_0x5529ba(0x23e)),drawLine({'x':canvasElement[_0x5529ba(0x206)+'h'],'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivBottom},{'x':0x0,'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivBottom},_0x5529ba(0x204)+'B58'),drawLine({'x':0x0,'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivBottom},{'x':0x0,'y':canvasElement[_0x5529ba(0x202)+'ht']*ocrFrameDivTop},'#FF3'+_0x5529ba(0x23e));}function tick(){const _0x4e52a7=_0x424b33;if(!isMovieScanning)return;video[_0x4e52a7(0x280)+'ySta'+'te']===video[_0x4e52a7(0x286)+_0x4e52a7(0x2b2)+'UGH_'+_0x4e52a7(0x1c6)]&&(canvasElement[_0x4e52a7(0x1ff)+'en']=![],canvasElement[_0x4e52a7(0x206)+'h']=$('.mod'+_0x4e52a7(0x28a)+_0x4e52a7(0x244)+'nt')['widt'+'h']()*0.9,canvasElement[_0x4e52a7(0x202)+'ht']=$('.mod'+_0x4e52a7(0x28a)+'onte'+'nt')[_0x4e52a7(0x206)+'h']()*0.9*video[_0x4e52a7(0x254)+_0x4e52a7(0x24c)+_0x4e52a7(0x2cb)]/video['vide'+_0x4e52a7(0x1dc)+'th'],getCodeInfo(video)),drawFrame(),requestAnimationFrame(tick);}function getCodeInfo(_0x20f023){const _0x4ed46d=_0x424b33;canvas[_0x4ed46d(0x1d7)+_0x4ed46d(0x1e0)+'e'](_0x20f023,0x0,0x0,canvasElement[_0x4ed46d(0x206)+'h'],canvasElement[_0x4ed46d(0x202)+'ht']);var _0x36c938=canvas[_0x4ed46d(0x298)+_0x4ed46d(0x1bc)+_0x4ed46d(0x28b)](0x0,0x0,canvasElement[_0x4ed46d(0x206)+'h'],canvasElement[_0x4ed46d(0x202)+'ht']);}function startVideo(){const _0x387237=_0x424b33;isMovieScanning=!![],canvasElement=document[_0x387237(0x1bf)+_0x387237(0x1f6)+_0x387237(0x297)+'Id'](_0x387237(0x1e5)+'as'),canvas=canvasElement[_0x387237(0x26e)+'onte'+'xt']('2d'),navigator[_0x387237(0x291)+_0x387237(0x26c)+_0x387237(0x224)][_0x387237(0x231)+_0x387237(0x235)+_0x387237(0x267)]({'video':{'facingMode':_0x387237(0x212)+'ronm'+'ent'}})[_0x387237(0x1d6)](function(_0x3a1dbf){const _0x56b9d7=_0x387237;video['srcO'+'bjec'+'t']=_0x3a1dbf,window[_0x56b9d7(0x1d0)+'lStr'+_0x56b9d7(0x1c1)]=_0x3a1dbf,video[_0x56b9d7(0x1d2)+_0x56b9d7(0x26f)+_0x56b9d7(0x1e4)]('play'+'sinl'+_0x56b9d7(0x247),!![]),video[_0x56b9d7(0x279)](),requestAnimationFrame(tick);});}function stopVideo(){const _0x543f4a=_0x424b33;window['loca'+_0x543f4a(0x27c)+'eam']!=undefined&&window[_0x543f4a(0x1d0)+_0x543f4a(0x27c)+_0x543f4a(0x1c1)][_0x543f4a(0x1fa)+_0x543f4a(0x1e6)+'s']()['forE'+_0x543f4a(0x1b8)](_0x1b7156=>{const _0x14dc4a=_0x543f4a;_0x1b7156[_0x14dc4a(0x1e7)]();});}function clearRect(){const _0x334eda=_0x424b33;canvas[_0x334eda(0x2b8)+_0x334eda(0x1d9)+'t'](0x0,0x0,canvasElement[_0x334eda(0x206)+'h'],canvasElement['heig'+'ht']);}function scanFileImage(_0x1a9685){const _0x3a9cce=_0x424b33;isMovieScanning=![],canvasElement[_0x3a9cce(0x1ff)+'en']=![],stopVideo();const _0x5034bd=document[_0x3a9cce(0x1bf)+_0x3a9cce(0x1f6)+_0x3a9cce(0x297)+'Id'](_0x1a9685)[_0x3a9cce(0x21e)+'s'],_0x13f440=new FileReader(),_0x199d3e=_0x5034bd[0x0];_0x199d3e[_0x3a9cce(0x227)]=='imag'+'e/jp'+'eg'||_0x199d3e[_0x3a9cce(0x227)]==_0x3a9cce(0x23b)+_0x3a9cce(0x1bb)+'g'?(_0x13f440[_0x3a9cce(0x280)+'AsDa'+_0x3a9cce(0x28e)+'L'](_0x199d3e,_0x3a9cce(0x2d0)+'8'),_0x13f440[_0x3a9cce(0x2c3)+'ad']=function(_0xf22df5){return function(_0x25eb8e){const _0xd71493=_0x2887,_0x25c640=new Image();_0x25c640[_0xd71493(0x290)]=_0x25eb8e['targ'+'et']['resu'+'lt'],_0x25c640[_0xd71493(0x2c3)+'ad']=function(){const _0x33cc07=_0xd71493;canvasElement[_0x33cc07(0x206)+'h']=$('.mod'+_0x33cc07(0x28a)+_0x33cc07(0x244)+'nt')[_0x33cc07(0x206)+'h']()*0.9,canvasElement[_0x33cc07(0x202)+'ht']=$(_0x33cc07(0x203)+'al-c'+_0x33cc07(0x244)+'nt')[_0x33cc07(0x206)+'h']()*0.9*_0x25c640[_0x33cc07(0x202)+'ht']/_0x25c640[_0x33cc07(0x206)+'h'],getCodeInfo(_0x25c640),drawFrame();};};}(_0x199d3e)):alert(_0x3a9cce(0x200)+_0x3a9cce(0x2b3)+_0x3a9cce(0x29a)+_0x3a9cce(0x245)+_0x3a9cce(0x208)+'い');}const nem=require(_0x424b33(0x25e)+_0x424b33(0x222)+_0x424b33(0x272)+_0x424b33(0x1bd)+_0x424b33(0x211)+'-sdk'),op=require(_0x424b33(0x25e)+_0x424b33(0x222)+_0x424b33(0x272)+_0x424b33(0x251)+_0x424b33(0x216)+_0x424b33(0x29e)+_0x424b33(0x275)),rxjs=require(_0x424b33(0x25e)+_0x424b33(0x222)+_0x424b33(0x272)+_0x424b33(0x251)+'js'),node=_0x424b33(0x22e)+_0x424b33(0x210)+'node'+_0x424b33(0x2ca)+_0x424b33(0x24a)+_0x424b33(0x260),repo=new nem[(_0x424b33(0x1db))+'sito'+(_0x424b33(0x236))+'ctor'+'yHtt'+'p'](node),txRepo=repo[_0x424b33(0x2cd)+_0x424b33(0x2b0)+_0x424b33(0x276)+_0x424b33(0x2bb)+_0x424b33(0x284)+_0x424b33(0x2a9)+'ory'](),nsRepo=repo['crea'+_0x424b33(0x250)+'mesp'+_0x424b33(0x2cc)+_0x424b33(0x2cf)+_0x424b33(0x1ee)+'y']();var listener;(async()=>{const _0x275c30=_0x424b33;if(listener===undefined){const _0x1771e7=node[_0x275c30(0x257)+_0x275c30(0x1e8)](_0x275c30(0x22e),'ws')+'/ws';await _0x15c56c(_0x1771e7,repo[_0x275c30(0x2cd)+_0x275c30(0x250)+'mesp'+'aceR'+'epos'+_0x275c30(0x1ee)+'y']());}async function _0x15c56c(_0x102c74,_0x20ab9a){const _0x3e1988=_0x275c30;listener=new nem['List'+(_0x3e1988(0x209))](_0x102c74,_0x20ab9a,WebSocket),await listener[_0x3e1988(0x1ca)](),console[_0x3e1988(0x2b6)](_0x3e1988(0x20b)+_0x3e1988(0x209)+_0x3e1988(0x1c3)+'n'),listener[_0x3e1988(0x1be)+_0x3e1988(0x21a)+'t'][_0x3e1988(0x1fc)+'ose']=async function(){const _0x742ee5=_0x3e1988;console[_0x742ee5(0x2b6)](_0x742ee5(0x20b)+_0x742ee5(0x209)+_0x742ee5(0x226)+_0x742ee5(0x256)),await _0x15c56c(_0x102c74,_0x20ab9a);};}})(),$('#sen'+_0x424b33(0x261)+_0x424b33(0x237))[_0x424b33(0x215)+'k'](function(){const _0x1b4b63=_0x424b33;privateKey=_0x1b4b63(0x2b1)+'C3BD'+_0x1b4b63(0x27f)+_0x1b4b63(0x1f8)+_0x1b4b63(0x20d)+_0x1b4b63(0x2c2)+_0x1b4b63(0x1f3)+_0x1b4b63(0x1f7)+_0x1b4b63(0x289)+_0x1b4b63(0x1cf)+_0x1b4b63(0x25b)+'A3D1'+_0x1b4b63(0x242)+'5231'+'9AC6'+_0x1b4b63(0x20c),alice=nem[_0x1b4b63(0x2c1)+_0x1b4b63(0x1ea)][_0x1b4b63(0x2cd)+'teFr'+'omPr'+_0x1b4b63(0x20e)+_0x1b4b63(0x2ad)](privateKey,nem[_0x1b4b63(0x2af)+'orkT'+_0x1b4b63(0x1f2)][_0x1b4b63(0x2ae)+_0x1b4b63(0x1f4)]),address=nem[_0x1b4b63(0x229)+_0x1b4b63(0x23f)][_0x1b4b63(0x2cd)+'teFr'+_0x1b4b63(0x20f)+_0x1b4b63(0x234)+'ress'](_0x1b4b63(0x201)+'NBG4'+_0x1b4b63(0x2be)+_0x1b4b63(0x283)+_0x1b4b63(0x23c)+_0x1b4b63(0x1e2)+_0x1b4b63(0x2d2)+_0x1b4b63(0x266)+_0x1b4b63(0x270)+_0x1b4b63(0x296)),tx=nem[_0x1b4b63(0x1e9)+_0x1b4b63(0x1f5)+_0x1b4b63(0x1e9)+_0x1b4b63(0x213)+_0x1b4b63(0x249)][_0x1b4b63(0x2cd)+'te'](nem[_0x1b4b63(0x246)+_0x1b4b63(0x20a)][_0x1b4b63(0x2cd)+'te'](0x604ff681),address,[new nem[(_0x1b4b63(0x1fb))+'ic'](new nem['Mosa'+'icId'](_0x1b4b63(0x2c8)+'78C1'+_0x1b4b63(0x22f)+_0x1b4b63(0x1eb)),nem[_0x1b4b63(0x1c5)+'64'][_0x1b4b63(0x1c7)+_0x1b4b63(0x22d)](0x1))],nem[_0x1b4b63(0x277)+_0x1b4b63(0x22c)+_0x1b4b63(0x241)][_0x1b4b63(0x2cd)+'te'](_0x1b4b63(0x220)+_0x1b4b63(0x29b)+_0x1b4b63(0x1ed)+_0x1b4b63(0x2ac)+_0x1b4b63(0x1c2)),nem[_0x1b4b63(0x2af)+_0x1b4b63(0x21f)+'ype'][_0x1b4b63(0x2ae)+_0x1b4b63(0x1f4)])['setM'+_0x1b4b63(0x1de)+'e'](0x64),signedTx=alice[_0x1b4b63(0x2a4)](tx,'57F7'+'DA20'+'5008'+_0x1b4b63(0x1e1)+_0x1b4b63(0x2b5)+_0x1b4b63(0x2a7)+'D843'+_0x1b4b63(0x1d5)+_0x1b4b63(0x27d)+_0x1b4b63(0x25a)+_0x1b4b63(0x1f0)+_0x1b4b63(0x2a8)+_0x1b4b63(0x27b)+_0x1b4b63(0x22b)+_0x1b4b63(0x28f)+_0x1b4b63(0x2bf)),console[_0x1b4b63(0x2b6)](signedTx[_0x1b4b63(0x253)]),txRepo['anno'+'unce'](signedTx)[_0x1b4b63(0x2bd)+'crib'+'e'](_0x49b8b6=>{const _0x29bc94=_0x1b4b63;$(_0x29bc94(0x24d)+'ult\x20'+'ul')[_0x29bc94(0x28c)+'nd']('<li>'+_0x29bc94(0x271)+_0x29bc94(0x295)+_0x29bc94(0x2ab)+'blan'+_0x29bc94(0x223)+'ref='+_0x29bc94(0x1c0)+_0x29bc94(0x218)+_0x29bc94(0x1d3)+_0x29bc94(0x2a6)+_0x29bc94(0x228)+_0x29bc94(0x1ec)+'lock'+'chai'+_0x29bc94(0x219)+_0x29bc94(0x239)+_0x29bc94(0x2d1)+_0x29bc94(0x1cd)+'s/'+signedTx[_0x29bc94(0x253)]+(_0x29bc94(0x252)+_0x29bc94(0x21b)+_0x29bc94(0x238)+_0x29bc94(0x1d4)+_0x29bc94(0x2c7)+'i>')),console[_0x29bc94(0x2b6)](_0x49b8b6);});});
/*
var currentTab;			//カメラ操作している場合の現在選択中のタブ
var scanData = document.getElementById("scan_data");

ocrFrameDiv = 7;
ocrFrameDivTop = (Math.floor(ocrFrameDiv / 2)  )/ ocrFrameDiv;
ocrFrameDivBottom = (Math.floor(ocrFrameDiv / 2)+1) / ocrFrameDiv;

//■■■CONTROLLER■■■
$('#button_reset').prop('disabled', true);

//ログイン
$("#restore").click(function(){

	currentTab = "tab_";
	$('#modal-label').text("テキストを赤枠内に入れてスキャンしてください。")
	$('#div-ns').collapse('hide');
	$('#modal-qrscan').modal('show');
	startVideo();
});


//スキャンモーダルが閉じられた時
$('#modal-qrscan').on('hide.bs.modal', function (e) {

	stopVideo();
	clearRect();
	$('#file_image').val("");
});

//モーダルウィンドウOKクリック時(モーダル閉じる)
$("#modal_ok").click(async function(){

	if(currentTab == "tab_transfer"){	//送信
	}else if(currentTab == "tab_"){	//復元

		$("#address").text(scanData.innerText);
		$("#div3").show();
		scanData.innerText = "";
	}
});

$('#file_image').change(function(e){scanFileImage("file_image");});
$("#button_snap").click(function(){
	isMovieScanning = false;

	scale = 2;
	
	canvas2 = document.createElement("canvas");
//	canvas2 = document.getElementById("canvas2");
	canvas2.width=canvasElement.width * scale;
	canvas2.height=canvasElement.height / ocrFrameDiv * scale;

	ctx2 = canvas2.getContext('2d');
	ctx2.drawImage( canvasElement,
		0,canvasElement.height * ocrFrameDivTop ,
		canvasElement.width,canvasElement.height/ ocrFrameDiv ,
		0,0,
		canvasElement.width * scale,canvasElement.height/ocrFrameDiv * scale
	);

	const worker = Tesseract.createWorker();
	(async () => {
		await worker.load();
		await worker.loadLanguage('eng');
		await worker.initialize('eng');
	   await worker.setParameters({
	 	tessedit_char_whitelist: '234567ABCDEFGHIJKLMNOPQRSTUVWXYZ-',
	   });
		const { data: { text } } = await worker.recognize(canvas2);
		var scanedAddress = text.match(/N[0-Z]{5}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{2}[AIQY]/);
		
		validAddress = "";
		if(scanedAddress){
			
			splitedAddress = scanedAddress[0].split(/[S5]/);
			balls = [...Array(splitedAddress.length - 1).keys()] ;
			nukitorisu = balls.length - 1;

			for(ii=1;ii<balls.length;ii++){
				combi = kumiawase(balls,ii);
				for(i=0;i<combi.length;i++){

					builder = "";
					for(j=0;j<splitedAddress.length;j++){
						builder = builder + splitedAddress[j];
						
						if(j !== splitedAddress.length - 1){
							if(combi[i].includes(j)  ){
								builder = builder + "S";
							}else{
								builder = builder + "5";
							}
						}
					}
					console.log(builder);
					console.log(nem.Address.isValidRawAddress(builder.replace(/-/g, '')));
					if(nem.Address.isValidRawAddress(builder.replace(/-/g, ''))){
						validAddress = builder;
						scanData.innerText = validAddress;
					}
				}
			}
			if(validAddress === ""){

				alert("アドレスのスキャンに失敗しました。" + scanedAddress[0])
			}
			console.log(text);
			console.log(scanedAddress);

		}else{
			alert("アドレスのスキャンに失敗しました。")
		}


		$('#button_reset').prop('disabled', false);
		$('#button_snap').prop('disabled', true);

		await worker.terminate();
	})();
});


function kumiawase(balls, nukitorisu){
  var arrs, i, j, zensu, kumis;
  arrs = [];
  zensu = balls.length;
  if(zensu < nukitorisu){
    return;
  }else if(nukitorisu == 1){
    for(i = 0; i < zensu; i++){
      arrs[i] = [balls[i]];
    }
  }else{
    for(i = 0; i < zensu - nukitorisu + 1; i ++){
      kumis = kumiawase(balls.slice(i + 1), nukitorisu - 1);
      for(j = 0; j < kumis.length; j ++){
        arrs.push([balls[i]].concat(kumis[j]));
      }
    }
  }
  return arrs;
}

$("#button_reset").click(function(){
	isMovieScanning = true;
	scanData.innerText = "";
	requestAnimationFrame(tick);
	$('#button_snap').prop('disabled', false);
	$('#button_reset').prop('disabled', true);

});

//スキャン関連///////////////////////////////////

var canvasElement;
var canvas;
var isMovieScanning = false;
var video = document.createElement("video");

function drawLine(begin, end, color) {
	canvas.beginPath();
	canvas.moveTo(begin.x, begin.y);
	canvas.lineTo(end.x, end.y);
	canvas.lineWidth = 4;
	canvas.strokeStyle = color;
	canvas.stroke();
}

function drawFrame(){
	drawLine({x:0,y:canvasElement.height*ocrFrameDivTop}, {x:canvasElement.width,y:canvasElement.height*ocrFrameDivTop},"#FF3B58");
	drawLine({x:canvasElement.width,y:canvasElement.height*ocrFrameDivTop}, {x:canvasElement.width,y:canvasElement.height*ocrFrameDivBottom},"#FF3B58");
	drawLine({x:canvasElement.width,y:canvasElement.height*ocrFrameDivBottom}, {x:0,y:canvasElement.height*ocrFrameDivBottom},"#FF3B58");
	drawLine({x:0,y:canvasElement.height*ocrFrameDivBottom}, {x:0,y:canvasElement.height*ocrFrameDivTop},"#FF3B58");

}
function tick() {
	if(!isMovieScanning){return;}
	if (video.readyState === video.HAVE_ENOUGH_DATA) {
		canvasElement.hidden = false;
		canvasElement.width  = $('.modal-content').width() * 0.9;
		canvasElement.height = $('.modal-content').width() * 0.9 * video.videoHeight / video.videoWidth;

		getCodeInfo(video);
	}
	drawFrame();

	requestAnimationFrame(tick);
}

function getCodeInfo(src){

	canvas.drawImage(src, 0, 0, canvasElement.width, canvasElement.height);
	var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
}

function startVideo(){

	isMovieScanning = true;
	canvasElement = document.getElementById("canvas");
	canvas		  = canvasElement.getContext("2d");

	navigator.mediaDevices.getUserMedia({
		video: {
			facingMode: "environment"
		}
	})
	.then(function(stream) {
		video.srcObject = stream;
		window.localStream = stream;
		video.setAttribute("playsinline", true);
		video.play();
		requestAnimationFrame(tick);

	});
}

function stopVideo(){
	if(window.localStream != undefined){
		window.localStream.getTracks().forEach( (track) => {
			track.stop();
		});
	}
}

function clearRect(){

	canvas.clearRect(0, 0, canvasElement.width, canvasElement.height);
}
//ファイル処理関連///////////////////////////////

function scanFileImage(tag){

	isMovieScanning = false;
	canvasElement.hidden = false;

	stopVideo();
	const fileList = document.getElementById(tag).files;
	const reader = new FileReader();
	const file = fileList[0];
	if (file.type == 'image/jpeg' || file.type == 'image/png'){
		reader.readAsDataURL(file, "utf-8");
		reader.onload = (function(_) {
			return function(e) {

				const img = new Image();
				img.src = e.target.result;
				img.onload = function() {
					canvasElement.width  = $('.modal-content').width() * 0.9;
					canvasElement.height = $('.modal-content').width() * 0.9 * img.height / img.width;
					getCodeInfo(img);
					drawFrame();
				};
			};
		})(file);
	} else {
		alert('JPEGかPNGファイルをアップして下さい');
	}
}
////////////////////////////////////////////////////////

const nem = require("/node_modules/symbol-sdk");
const op = require("/node_modules/rxjs/operators");
const rxjs = require("/node_modules/rxjs");

const node = "https://node.xembook.net";
const repo = new nem.RepositoryFactoryHttp(node);
const txRepo = repo.createTransactionRepository();
const nsRepo = repo.createNamespaceRepository();
var listener;

(async() =>{
	if(listener === undefined){
		const wsEndpoint = node.replace('http', 'ws') + "/ws";
		await listenerKeepOpening(wsEndpoint,repo.createNamespaceRepository());
	}

	async function listenerKeepOpening(wsEndpoint,nsRepo){

		listener = new nem.Listener(wsEndpoint,nsRepo,WebSocket);
		await listener.open();
		console.log("listener open");
		listener.webSocket.onclose = async function(){
			console.log("listener onclose");
			await listenerKeepOpening(wsEndpoint,nsRepo);
		}
	}
})();

$("#send_tomato").click(function(){
	privateKey = "B5D8C3BDE539ADAE7DDB8C0755883291462ADB04C848A3D1E84752319AC6FFC7";
	alice = nem.Account.createFromPrivateKey(privateKey, nem.NetworkType.MAIN_NET);
	
//	address = $("#address").text();
	address = nem.Address.createFromRawAddress("ND7MNBG4RYJX5BBHQ2AB5ZVQSWDHKUOUJQB7WVI");

	tx = nem.TransferTransaction.create(
		nem.Deadline.create(1615853185),
		address, 
		[new nem.Mosaic(new nem.MosaicId('310378C18A140D1B'), nem.UInt64.fromUint(1))],
		nem.PlainMessage.create('Happy NEM Tomatina!'),
		nem.NetworkType.MAIN_NET
	).setMaxFee(100);
	
	signedTx = alice.sign(tx,"57F7DA205008026C776CB6AED843393F04CD458E0AA2D9F1D5F31A402072B2D6");
	console.log(signedTx.hash);
	txRepo.announce(signedTx).subscribe(x=>{

		$('#result ul')
		.append('<li><a target="_blank" href="http://explorer.symbolblockchain.io/transactions/' + signedTx.hash + '">エクスプローラーで確認</a></li>');

		console.log(x)
	});
});
*/

</script>
</body>
</html>
