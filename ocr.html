<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
	integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	crossorigin="anonymous">
</head>
<body>
<div class="container">

	<h1>OCR🍅</h1>

	<div id="div1">
		<button type="button" id="restore" class="btn btn-primary">カメラ起動</button>
	</div><!-- div1 -->

	<div class="collapse" id="div3">
		<div id="address"></div>
		<button type="button" id="send_tomato" class="btn btn-primary">送信</button>
		<div id="result">
			<ul></ul>
		</div>
	</div><!-- div3 -->
</div>

<!-- スキャンモーダル -->
<div class="modal fade" id="modal-qrscan" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel2">OCRスキャン</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="閉じる">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<label id="modal-label"></label>

				<div class="input-group">
					<label class="input-group-btn mr-1">
						<span class="btn btn-primary">
							画像でスキャン<input id="file_image" type="file" style="display:none">
						</span>
					</label>
				</div>
				<canvas id="canvas"  width="100%" hidden></canvas>
				<!-- canvas id="canvas2"  width="100%"></canvas -->
				<button type="button" id="button_snap" class="btn btn-primary">
					スナップ
				</button>
				<button type="button" id="button_reset" class="btn btn-primary">
					リセット
				</button>
				<div id="scan_data" class="text-break"></div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">キャンセル</button>
				<button type="button" class="btn btn-primary" data-dismiss="modal"	id="modal_ok">OK</button>

			</div><!-- /.modal-footer -->
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript" src="https://unpkg.com/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
	integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
	crossorigin="anonymous">
</script>
<script src="symbol-sdk-pack-1.0.1.js"></script>
<script src="https://xembook.github.io/xembook/xembook_config.js"></script>

<script>

function _0x5ed7(){const _0x3fb8db=['i2rPDG','i2j1Da','44k544ox44oT44o8','sw1HzW','6kQnpc9H','BgvUzW','C3rVCa','C3rYBW','zw5N','Aw1HzW','lNn5Bq','ntDgnW','mZi5mq','Aw5Uzq','v2LKDa','C2fNzq','mZm0odu2n0Hov1jlqG','DgvgCG','B250zq','ywXFBW','Bg9N','Bw9Kyq','refuqq','Aw5HDa','44glue5h','zxrLCG','BgvTzq','DxrMlq','ntiZmq','yxDbza','i3nLBG','mJGYnJi1mMXOs1rSBG','ANmVBW','DgfvuG','zuTLEq','AwnLCW','i0zgmW','yMvNAq','ywnO','AgLKzq','yNv0zq','Dw5Jzq','n0reqG','zw5LCG','CNnJyq','lMjZlG','BgLUzq','AgvPzW','qJjenG','ntmWmZu0ngDWtgTYwq','CLrLEa','BK1LCW','DhrYAq','CMvJBW','tKjhna','44k544kT44oJ44oZ','DMfS','44gx44gM5lIl44gv','BNrcEq','nujcsa','mefbmG','DgLVBG','utjbqG','CMvZCW','nJDbqG','DhjHBG','zv9PBq','CMvHza','vuDixW','i2zPBa','nZjcC25JweO','CLjLyW','BNnHyW','C2L0BW','ChvZAa','Dg9Yzq','C3vICW','Bwf0Aq','nZHdmq','u1Desa','lM5LDa','ChjVCa','Axnwyq','zNjVBq','mJy0n1PwvePnrG','z2v0qW','Aw5PDa','AwfSAq','44gU44k544kT44oJ','C2v0tq','i3jLCW','tsbuBW','qwrKCG','Bw92zq','AgfZAa','iMH0Da','pgXPpG','qwnJBW','yurLDG','B3j5','vhjHBG','vwLUDa','44gx44g+44gx44gF','Bg9Hza','B3jRva','44oP44o844gN56k6','sLfcnW','CgvYyq','nvPwuq','DgHLBG','y2HHBG','qZG0oa','ExbL','tMv0DW','l25Vza','tw9Zyq','DgvYBq','ywjLBa','rtuZoq','zw52Aq','yxbZzq','z2v0rq','rgvHza','pgeGDa','yxjNzq','CMvMpq','mZeWmW','x05fva','C2v0ua','DwrLCW','Bg9Jyq','s1vpvq','z2v0va','C3bSAq','qurbrq','DgfYzW','Dg9UxW','v1zj','yM9VAW','zMXVBW','D0fKza','oemWnW','BLjLCa','BwvZCa','B25SBW','reeYma','Dw50','x2LTyq','mJm0nq','DwfNzq','Awnjza','B3bLBG','lM1Vza','ywDL','rKzdnW','zxnZ','BwvKAq','qxneyq','y29UyW','qJu4','Dg9YCW','ndyYqq','qJzbrq','44ov44kH44kK44oR','BwfNzq','BMeH','B21qCG','CMvZDq','DMLKzq','ndu4rq','rtG0nW','BwjVBa','CZOVlW','zv9TBW','C2HVDW','44oZ44gR5AsX5Pwx','t1bruG','y3jPyG','EwXL','y3rVCG','rdLgmq','yxbWzq','lNHLBq','x0votW','B25JBa','AxrVCG','qZncra','C2vYtq','mZyWnZmZmKz0q2jeqq','v1HzwG','s0XntG','CMfJAW','CM9UBq','q0rfrG','y3rPBW','CMTLCG','rdvgmW','DgvxBW','zhvSzq','rgf0yq','CMvZzq','DhLWzq','y29SBa','z25PEG','B3nPDa','ywWTCq','C2zLCG','yxjHBq','B21syq','ywnLuG','44og44kT44k544oi','ntaWoa','Aw5JBa','yw5UBW','C2LUBa','y2fUDG','yM9SyG','DwX0ia','u1rvvG','CY9YEa','zgLZyq','CMvWBa','ywnL','CdOVlW','zxbVCW','yMXLza','r0HjsG','44ks44kI44od44ox','mJK2otG3nNvkBeXbuG','ywWTBa','C2v0qq','Bg9Zzq','DgfIxW','Dgvoyq','D2LKDa','B1DPza','DgvfBa','AgLKza','tufjtG','Aw5L','nZC2qW','zhjHDW','l3rYyq','z2v0vq','y3jLyq','zwfT','zs9QCa','mdrdra','y2XLyq','C2XPyW','vuLUDa','Bfn0CG','i21Vza','tKq3tq','44kI44oj44oS44k5','i2fKza','BgLZDa','sgfWCa','Dd0IxW','BgLKuG','x2rHDa','C25HCa','mta0otiWnxPsAxrNCa','zw1LBG','yMXHBG','D2vIuW','AxzHDa','zwrPyq','BI5PBW','zMLSzq','ywWTyW','uLLkwa','B2nRzq','EuH0Da','sLbfrW','Esborq','y2XPyW','C3jJ','nJK0DgX0wMns','DgvuCG'];_0x5ed7=function(){return _0x3fb8db;};return _0x5ed7();}const _0x140013=_0xd783;(function(_0x2155cd,_0x5155a3){const _0x1fc302=_0xd783,_0x152688=_0x2155cd();while(!![]){try{const _0x344437=parseInt(_0x1fc302(0x281))/0x1*(parseInt(_0x1fc302(0x22b))/0x2)+parseInt(_0x1fc302(0x24c))/0x3+parseInt(_0x1fc302(0x2e9))/0x4+-parseInt(_0x1fc302(0x21b))/0x5+parseInt(_0x1fc302(0x25e))/0x6+parseInt(_0x1fc302(0x1f9))/0x7+-parseInt(_0x1fc302(0x273))/0x8*(parseInt(_0x1fc302(0x23d))/0x9);if(_0x344437===_0x5155a3)break;else _0x152688['push'](_0x152688['shift']());}catch(_0x38cbe7){_0x152688['push'](_0x152688['shift']());}}}(_0x5ed7,0x7d0d2));var currentTab,scanData=document[_0x140013(0x2a6)+_0x140013(0x247)+_0x140013(0x267)+'Id']('scan'+_0x140013(0x219)+'a');ocrFrameDiv=0x7,ocrFrameDivTop=Math[_0x140013(0x2b8)+'r'](ocrFrameDiv/0x2)/ocrFrameDiv,ocrFrameDivBottom=(Math[_0x140013(0x2b8)+'r'](ocrFrameDiv/0x2)+0x1)/ocrFrameDiv,$(_0x140013(0x22e)+_0x140013(0x2b5)+_0x140013(0x1dd)+'t')[_0x140013(0x27e)](_0x140013(0x1f1)+_0x140013(0x1f6),!![]),$('#res'+_0x140013(0x278))[_0x140013(0x229)+'k'](function(){const _0x33ba0f=_0x140013;currentTab=_0x33ba0f(0x1fd),$(_0x33ba0f(0x211)+_0x33ba0f(0x1fa)+_0x33ba0f(0x2a2))['text'](_0x33ba0f(0x1e7)+'を赤枠内'+'に入れて'+_0x33ba0f(0x264)+'してくだ'+'さい。'),$(_0x33ba0f(0x22d)+'-ns')[_0x33ba0f(0x1df)+_0x33ba0f(0x2a5)](_0x33ba0f(0x254)),$(_0x33ba0f(0x211)+_0x33ba0f(0x1e2)+_0x33ba0f(0x259)+'n')[_0x33ba0f(0x242)+'l'](_0x33ba0f(0x2db)),startVideo();}),$(_0x140013(0x211)+'al-q'+'rsca'+'n')['on'](_0x140013(0x254)+_0x140013(0x25a)+_0x140013(0x242)+'l',function(_0x7a372d){const _0x3633eb=_0x140013;stopVideo(),clearRect(),$('#fil'+_0x3633eb(0x26f)+_0x3633eb(0x2c6))[_0x3633eb(0x265)]('');}),$('#mod'+_0x140013(0x240)+'k')[_0x140013(0x229)+'k'](async function(){const _0xe4b34=_0x140013;if(currentTab==_0xe4b34(0x1fd)+_0xe4b34(0x26e)+'sfer'){}else currentTab=='tab_'&&($(_0xe4b34(0x214)+'ress')['text'](scanData[_0xe4b34(0x23a)+'rTex'+'t']),$(_0xe4b34(0x22d)+'3')[_0xe4b34(0x2db)](),scanData[_0xe4b34(0x23a)+_0xe4b34(0x25f)+'t']='');}),$(_0x140013(0x272)+_0x140013(0x26f)+_0x140013(0x2c6))[_0x140013(0x29b)+'ge'](function(_0x56c18c){const _0x1d797f=_0x140013;scanFileImage(_0x1d797f(0x222)+_0x1d797f(0x2c0)+'ge');}),$('#but'+_0x140013(0x2b5)+_0x140013(0x21a))['clic'+'k'](function(){const _0x364ca5=_0x140013;isMovieScanning=![],scale=0x2,canvas2=document['crea'+_0x364ca5(0x201)+_0x364ca5(0x21c)+'t'](_0x364ca5(0x1ec)+'as'),canvas2[_0x364ca5(0x1ff)+'h']=canvasElement[_0x364ca5(0x1ff)+'h']*scale,canvas2[_0x364ca5(0x25c)+'ht']=canvasElement['heig'+'ht']/ocrFrameDiv*scale,ctx2=canvas2['getC'+_0x364ca5(0x23f)+'xt']('2d'),ctx2['draw'+_0x364ca5(0x230)+'e'](canvasElement,0x0,canvasElement[_0x364ca5(0x25c)+'ht']*ocrFrameDivTop,canvasElement[_0x364ca5(0x1ff)+'h'],canvasElement[_0x364ca5(0x25c)+'ht']/ocrFrameDiv,0x0,0x0,canvasElement[_0x364ca5(0x1ff)+'h']*scale,canvasElement[_0x364ca5(0x25c)+'ht']/ocrFrameDiv*scale);const _0x48d28e=Tesseract['crea'+_0x364ca5(0x1da)+_0x364ca5(0x2f0)]();(async()=>{const _0x218110=_0x364ca5;await _0x48d28e[_0x218110(0x294)](),await _0x48d28e[_0x218110(0x294)+'Lang'+_0x218110(0x2c2)](_0x218110(0x235)),await _0x48d28e[_0x218110(0x283)+_0x218110(0x284)+'ze']('eng'),await _0x48d28e[_0x218110(0x2ad)+_0x218110(0x1e4)+_0x218110(0x246)+'s']({'tessedit_char_whitelist':_0x218110(0x2c1)+_0x218110(0x26d)+_0x218110(0x2ee)+_0x218110(0x1f7)+_0x218110(0x2eb)+_0x218110(0x2dd)+_0x218110(0x1ef)+_0x218110(0x2ea)+'-'});const {data:{text:_0x461c03}}=await _0x48d28e[_0x218110(0x262)+_0x218110(0x1e0)+'e'](canvas2);var _0x30dc9d=_0x461c03['matc'+'h'](/N[0-Z]{5}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{2}[AIQY]/);validAddress='';if(_0x30dc9d){splitedAddress=_0x30dc9d[0x0][_0x218110(0x2b2)+'t'](/[S5]/),balls=[...Array(splitedAddress['leng'+'th']-0x1)['keys']()],nukitorisu=balls['leng'+'th']-0x1;for(ii=0x1;ii<balls['leng'+'th'];ii++){combi=kumiawase(balls,ii);for(i=0x0;i<combi['leng'+'th'];i++){builder='';for(j=0x0;j<splitedAddress[_0x218110(0x232)+'th'];j++){builder=builder+splitedAddress[j],j!==splitedAddress[_0x218110(0x232)+'th']-0x1&&(combi[i][_0x218110(0x1e9)+_0x218110(0x2ae)](j)?builder=builder+'S':builder=builder+'5');}console[_0x218110(0x241)](builder),console[_0x218110(0x241)](nem[_0x218110(0x289)+_0x218110(0x2c8)][_0x218110(0x27f)+_0x218110(0x218)+_0x218110(0x24a)+'dres'+'s'](builder['repl'+_0x218110(0x1f3)](/-/g,''))),nem[_0x218110(0x289)+'ess'][_0x218110(0x27f)+_0x218110(0x218)+_0x218110(0x24a)+'dres'+'s'](builder[_0x218110(0x1f2)+'ace'](/-/g,''))&&(validAddress=builder,scanData[_0x218110(0x23a)+_0x218110(0x25f)+'t']=_0x30dc9d);}}validAddress===''&&alert(_0x218110(0x213)+_0x218110(0x285)+'ンに失敗'+_0x218110(0x293)+'。'),console[_0x218110(0x241)](_0x461c03),console[_0x218110(0x241)](_0x30dc9d);}else alert(_0x218110(0x213)+_0x218110(0x285)+_0x218110(0x2dc)+'しました'+'。');$(_0x218110(0x22e)+_0x218110(0x2b5)+_0x218110(0x1dd)+'t')[_0x218110(0x27e)](_0x218110(0x1f1)+_0x218110(0x1f6),![]),$(_0x218110(0x22e)+'ton_'+'snap')[_0x218110(0x27e)](_0x218110(0x1f1)+_0x218110(0x1f6),!![]),await _0x48d28e[_0x218110(0x2a1)+_0x218110(0x244)+'e']();})();});function kumiawase(_0x264ee6,_0x29d71c){const _0x20770e=_0x140013;var _0x3844cc,_0x2b3176,_0x2c3e84,_0x59f5e8,_0x1a634b;_0x3844cc=[],_0x59f5e8=_0x264ee6[_0x20770e(0x232)+'th'];if(_0x59f5e8<_0x29d71c)return;else{if(_0x29d71c==0x1)for(_0x2b3176=0x0;_0x2b3176<_0x59f5e8;_0x2b3176++){_0x3844cc[_0x2b3176]=[_0x264ee6[_0x2b3176]];}else for(_0x2b3176=0x0;_0x2b3176<_0x59f5e8-_0x29d71c+0x1;_0x2b3176++){_0x1a634b=kumiawase(_0x264ee6[_0x20770e(0x20e)+'e'](_0x2b3176+0x1),_0x29d71c-0x1);for(_0x2c3e84=0x0;_0x2c3e84<_0x1a634b[_0x20770e(0x232)+'th'];_0x2c3e84++){_0x3844cc[_0x20770e(0x277)]([_0x264ee6[_0x2b3176]][_0x20770e(0x2cb)+'at'](_0x1a634b[_0x2c3e84]));}}}return _0x3844cc;}$(_0x140013(0x22e)+_0x140013(0x2b5)+_0x140013(0x1dd)+'t')[_0x140013(0x229)+'k'](function(){const _0x330e66=_0x140013;isMovieScanning=!![],scanData[_0x330e66(0x23a)+_0x330e66(0x25f)+'t']='',requestAnimationFrame(tick),$(_0x330e66(0x22e)+_0x330e66(0x2b5)+_0x330e66(0x21a))[_0x330e66(0x27e)](_0x330e66(0x1f1)+_0x330e66(0x1f6),![]),$(_0x330e66(0x22e)+_0x330e66(0x2b5)+_0x330e66(0x1dd)+'t')['prop'](_0x330e66(0x1f1)+_0x330e66(0x1f6),!![]);});var canvasElement,canvas,isMovieScanning=![],video=document['crea'+_0x140013(0x201)+_0x140013(0x21c)+'t'](_0x140013(0x2d5)+'o');function drawLine(_0x1597d2,_0x1b8b87,_0x2a3609){const _0x510f48=_0x140013;canvas[_0x510f48(0x252)+'nPat'+'h'](),canvas[_0x510f48(0x28a)+'To'](_0x1597d2['x'],_0x1597d2['y']),canvas[_0x510f48(0x25b)+'To'](_0x1b8b87['x'],_0x1b8b87['y']),canvas['line'+_0x510f48(0x23b)+'h']=0x4,canvas['stro'+'keSt'+_0x510f48(0x2df)]=_0x2a3609,canvas[_0x510f48(0x234)+'ke']();}function drawFrame(){const _0x376bfd=_0x140013;drawLine({'x':0x0,'y':canvasElement[_0x376bfd(0x25c)+'ht']*ocrFrameDivTop},{'x':canvasElement['widt'+'h'],'y':canvasElement['heig'+'ht']*ocrFrameDivTop},_0x376bfd(0x251)+_0x376bfd(0x2cc)),drawLine({'x':canvasElement['widt'+'h'],'y':canvasElement[_0x376bfd(0x25c)+'ht']*ocrFrameDivTop},{'x':canvasElement['widt'+'h'],'y':canvasElement[_0x376bfd(0x25c)+'ht']*ocrFrameDivBottom},_0x376bfd(0x251)+_0x376bfd(0x2cc)),drawLine({'x':canvasElement['widt'+'h'],'y':canvasElement['heig'+'ht']*ocrFrameDivBottom},{'x':0x0,'y':canvasElement['heig'+'ht']*ocrFrameDivBottom},_0x376bfd(0x251)+'B58'),drawLine({'x':0x0,'y':canvasElement[_0x376bfd(0x25c)+'ht']*ocrFrameDivBottom},{'x':0x0,'y':canvasElement[_0x376bfd(0x25c)+'ht']*ocrFrameDivTop},'#FF3'+'B58');}function tick(){const _0x992567=_0x140013;if(!isMovieScanning)return;video['read'+'ySta'+'te']===video['HAVE'+_0x992567(0x2e4)+_0x992567(0x271)+_0x992567(0x243)]&&(canvasElement[_0x992567(0x202)+'en']=![],canvasElement['widt'+'h']=$(_0x992567(0x2c5)+'al-c'+'onte'+'nt')[_0x992567(0x1ff)+'h']()*0.9,canvasElement['heig'+'ht']=$(_0x992567(0x2c5)+_0x992567(0x223)+_0x992567(0x23f)+'nt')[_0x992567(0x1ff)+'h']()*0.9*video[_0x992567(0x2d5)+'oHei'+'ght']/video['vide'+_0x992567(0x200)+'th'],getCodeInfo(video)),drawFrame(),requestAnimationFrame(tick);}function getCodeInfo(_0xe1d595){const _0x5a893c=_0x140013;canvas[_0x5a893c(0x206)+_0x5a893c(0x230)+'e'](_0xe1d595,0x0,0x0,canvasElement[_0x5a893c(0x1ff)+'h'],canvasElement['heig'+'ht']);var _0x38b4a9=canvas['getI'+_0x5a893c(0x2d1)+_0x5a893c(0x1dc)](0x0,0x0,canvasElement['widt'+'h'],canvasElement[_0x5a893c(0x25c)+'ht']);}function startVideo(){const _0x1d78dd=_0x140013;isMovieScanning=!![],canvasElement=document[_0x1d78dd(0x2a6)+_0x1d78dd(0x247)+_0x1d78dd(0x267)+'Id'](_0x1d78dd(0x1ec)+'as'),canvas=canvasElement[_0x1d78dd(0x282)+_0x1d78dd(0x23f)+'xt']('2d'),navigator[_0x1d78dd(0x2c9)+_0x1d78dd(0x28f)+_0x1d78dd(0x250)][_0x1d78dd(0x208)+_0x1d78dd(0x2e8)+_0x1d78dd(0x220)]({'video':{'facingMode':_0x1d78dd(0x2a4)+_0x1d78dd(0x2ed)+'ent'}})[_0x1d78dd(0x29a)](function(_0x4cb4c2){const _0x21b191=_0x1d78dd;video['srcO'+'bjec'+'t']=_0x4cb4c2,window[_0x21b191(0x2af)+_0x21b191(0x210)+'eam']=_0x4cb4c2,video[_0x21b191(0x1fb)+_0x21b191(0x261)+_0x21b191(0x255)]('play'+_0x21b191(0x1eb)+_0x21b191(0x204),!![]),video['play'](),requestAnimationFrame(tick);});}function stopVideo(){const _0x2a0c0f=_0x140013;window[_0x2a0c0f(0x2af)+_0x2a0c0f(0x210)+_0x2a0c0f(0x20a)]!=undefined&&window['loca'+_0x2a0c0f(0x210)+_0x2a0c0f(0x20a)][_0x2a0c0f(0x2b1)+_0x2a0c0f(0x2ec)+'s']()['forE'+_0x2a0c0f(0x253)](_0xe75516=>{const _0x22411e=_0x2a0c0f;_0xe75516[_0x22411e(0x233)]();});}function _0xd783(_0x22e459,_0x2ccfc2){const _0x5ed7dc=_0x5ed7();return _0xd783=function(_0xd78358,_0xf057e7){_0xd78358=_0xd78358-0x1da;let _0x31419e=_0x5ed7dc[_0xd78358];if(_0xd783['LtOWiO']===undefined){var _0xff61df=function(_0x7a372d){const _0x56c18c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x48d28e='',_0x461c03='';for(let _0x30dc9d=0x0,_0x264ee6,_0x29d71c,_0x3844cc=0x0;_0x29d71c=_0x7a372d['charAt'](_0x3844cc++);~_0x29d71c&&(_0x264ee6=_0x30dc9d%0x4?_0x264ee6*0x40+_0x29d71c:_0x29d71c,_0x30dc9d++%0x4)?_0x48d28e+=String['fromCharCode'](0xff&_0x264ee6>>(-0x2*_0x30dc9d&0x6)):0x0){_0x29d71c=_0x56c18c['indexOf'](_0x29d71c);}for(let _0x2b3176=0x0,_0x2c3e84=_0x48d28e['length'];_0x2b3176<_0x2c3e84;_0x2b3176++){_0x461c03+='%'+('00'+_0x48d28e['charCodeAt'](_0x2b3176)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x461c03);};_0xd783['QaVUgW']=_0xff61df,_0x22e459=arguments,_0xd783['LtOWiO']=!![];}const _0x3f110c=_0x5ed7dc[0x0],_0x4d8326=_0xd78358+_0x3f110c,_0x74b924=_0x22e459[_0x4d8326];return!_0x74b924?(_0x31419e=_0xd783['QaVUgW'](_0x31419e),_0x22e459[_0x4d8326]=_0x31419e):_0x31419e=_0x74b924,_0x31419e;},_0xd783(_0x22e459,_0x2ccfc2);}function clearRect(){const _0x521ece=_0x140013;canvas[_0x521ece(0x20d)+_0x521ece(0x274)+'t'](0x0,0x0,canvasElement['widt'+'h'],canvasElement['heig'+'ht']);}function scanFileImage(_0x5054c0){const _0x329018=_0x140013;isMovieScanning=![],canvasElement[_0x329018(0x202)+'en']=![],stopVideo();const _0x392bf5=document['getE'+_0x329018(0x247)+_0x329018(0x267)+'Id'](_0x5054c0)[_0x329018(0x222)+'s'],_0x5b07fe=new FileReader(),_0xa32ac7=_0x392bf5[0x0];_0xa32ac7[_0x329018(0x1de)]==_0x329018(0x236)+_0x329018(0x20b)+'eg'||_0xa32ac7['type']==_0x329018(0x236)+'e/pn'+'g'?(_0x5b07fe[_0x329018(0x270)+_0x329018(0x2ca)+_0x329018(0x24e)+'L'](_0xa32ac7,_0x329018(0x248)+'8'),_0x5b07fe['onlo'+'ad']=function(_0x5efe29){return function(_0x4ab3bd){const _0x438542=_0xd783,_0x4daa19=new Image();_0x4daa19[_0x438542(0x22a)]=_0x4ab3bd[_0x438542(0x2b4)+'et'][_0x438542(0x2d4)+'lt'],_0x4daa19[_0x438542(0x2bd)+'ad']=function(){const _0x279aa9=_0x438542;canvasElement[_0x279aa9(0x1ff)+'h']=$(_0x279aa9(0x2c5)+_0x279aa9(0x223)+_0x279aa9(0x23f)+'nt')[_0x279aa9(0x1ff)+'h']()*0.9,canvasElement['heig'+'ht']=$('.mod'+_0x279aa9(0x223)+_0x279aa9(0x23f)+'nt')['widt'+'h']()*0.9*_0x4daa19['heig'+'ht']/_0x4daa19[_0x279aa9(0x1ff)+'h'],getCodeInfo(_0x4daa19),drawFrame();};};}(_0xa32ac7)):alert(_0x329018(0x227)+_0x329018(0x245)+_0x329018(0x2d0)+_0x329018(0x1f8)+_0x329018(0x266)+'い');}const nem=require(_0x140013(0x29f)+'e_mo'+'dule'+'s/sy'+_0x140013(0x2d8)+'-sdk'),op=require(_0x140013(0x29f)+_0x140013(0x2da)+_0x140013(0x1db)+'s/rx'+_0x140013(0x24d)+_0x140013(0x298)+_0x140013(0x2cd)),rxjs=require(_0x140013(0x29f)+_0x140013(0x2da)+_0x140013(0x1db)+_0x140013(0x1f0)+'js'),node='http'+_0x140013(0x2d9)+'node'+_0x140013(0x2e3)+_0x140013(0x2b7)+_0x140013(0x27d),repo=new nem['Repo'+(_0x140013(0x276))+'ryFa'+(_0x140013(0x2e0))+(_0x140013(0x226))+'p'](node),txRepo=repo[_0x140013(0x209)+_0x140013(0x22c)+'ansa'+_0x140013(0x2ef)+_0x140013(0x2bb)+_0x140013(0x1e1)+_0x140013(0x290)](),nsRepo=repo[_0x140013(0x209)+_0x140013(0x1fe)+_0x140013(0x2bc)+_0x140013(0x1e6)+_0x140013(0x1f5)+_0x140013(0x2e6)+'y']();var listener;(async()=>{const _0x212e3d=_0x140013;if(listener===undefined){const _0x324284=node[_0x212e3d(0x1f2)+_0x212e3d(0x1f3)]('http','ws')+'/ws';await _0x3d4329(_0x324284,repo[_0x212e3d(0x209)+_0x212e3d(0x1fe)+'mesp'+_0x212e3d(0x1e6)+_0x212e3d(0x1f5)+_0x212e3d(0x2e6)+'y']());}async function _0x3d4329(_0x33df3f,_0x30dcc6){const _0x168599=_0x212e3d;listener=new nem['List'+(_0x168599(0x258))](_0x33df3f,_0x30dcc6,WebSocket),await listener[_0x168599(0x2c4)](),console[_0x168599(0x241)](_0x168599(0x215)+_0x168599(0x258)+'\x20ope'+'n'),listener[_0x168599(0x21e)+_0x168599(0x225)+'t'][_0x168599(0x2e5)+'ose']=async function(){const _0x186685=_0x168599;console['log']('list'+_0x186685(0x258)+'\x20onc'+_0x186685(0x1fc)),await _0x3d4329(_0x33df3f,_0x30dcc6);};}})(),$(_0x140013(0x24b)+'d_to'+'mato')[_0x140013(0x229)+'k'](function(){const _0x5b863c=_0x140013;privateKey='B5D8'+_0x5b863c(0x2e7)+_0x5b863c(0x2a3)+_0x5b863c(0x2b3)+_0x5b863c(0x257)+_0x5b863c(0x2ba)+'5588'+_0x5b863c(0x239)+_0x5b863c(0x2ce)+'DB04'+_0x5b863c(0x29c)+'A3D1'+_0x5b863c(0x2d7)+_0x5b863c(0x249)+'9AC6'+_0x5b863c(0x2c7),alice=nem[_0x5b863c(0x28e)+_0x5b863c(0x2bf)][_0x5b863c(0x209)+'teFr'+_0x5b863c(0x2d3)+_0x5b863c(0x21f)+_0x5b863c(0x24f)](privateKey,nem['Netw'+_0x5b863c(0x295)+_0x5b863c(0x29d)][_0x5b863c(0x203)+_0x5b863c(0x2ac)]),address=nem[_0x5b863c(0x289)+_0x5b863c(0x2c8)][_0x5b863c(0x209)+_0x5b863c(0x23e)+_0x5b863c(0x1e5)+_0x5b863c(0x2b9)+_0x5b863c(0x26c)](_0x5b863c(0x212)+_0x5b863c(0x263)+_0x5b863c(0x224)+_0x5b863c(0x268)+_0x5b863c(0x26b)+_0x5b863c(0x299)+_0x5b863c(0x27c)+_0x5b863c(0x2b0)+_0x5b863c(0x297)+_0x5b863c(0x2b6)),tx=nem[_0x5b863c(0x291)+_0x5b863c(0x1e3)+_0x5b863c(0x291)+'sact'+'ion'][_0x5b863c(0x209)+'te'](nem[_0x5b863c(0x2a7)+_0x5b863c(0x25b)][_0x5b863c(0x209)+'te'](0x604ff681),address,[new nem[(_0x5b863c(0x2a0))+'ic'](new nem[(_0x5b863c(0x2a0))+(_0x5b863c(0x2c3))](_0x5b863c(0x2ab)+_0x5b863c(0x27b)+'8A14'+'0D1B'),nem[_0x5b863c(0x20f)+'64'][_0x5b863c(0x280)+_0x5b863c(0x292)](0x1))],nem['Plai'+_0x5b863c(0x260)+_0x5b863c(0x23c)][_0x5b863c(0x209)+'te'](_0x5b863c(0x216)+_0x5b863c(0x228)+_0x5b863c(0x288)+_0x5b863c(0x27a)+_0x5b863c(0x2d2)),nem[_0x5b863c(0x29e)+_0x5b863c(0x295)+_0x5b863c(0x29d)][_0x5b863c(0x203)+_0x5b863c(0x2ac)])[_0x5b863c(0x286)+'axFe'+'e'](0x64),signedTx=alice['sign'](tx,_0x5b863c(0x238)+_0x5b863c(0x2be)+_0x5b863c(0x1e8)+'026C'+_0x5b863c(0x205)+_0x5b863c(0x2cf)+'D843'+'393F'+_0x5b863c(0x20c)+_0x5b863c(0x2d6)+_0x5b863c(0x269)+_0x5b863c(0x2e1)+_0x5b863c(0x2f1)+'1A40'+'2072'+_0x5b863c(0x25d)),console[_0x5b863c(0x241)](signedTx['hash']),txRepo[_0x5b863c(0x1ea)+_0x5b863c(0x256)](signedTx)[_0x5b863c(0x279)+_0x5b863c(0x2de)+'e'](_0x569f71=>{const _0x4f6d00=_0x5b863c;$(_0x4f6d00(0x287)+_0x4f6d00(0x1ee)+'ul')[_0x4f6d00(0x2e2)+'nd'](_0x4f6d00(0x28d)+_0x4f6d00(0x2a8)+_0x4f6d00(0x2a9)+_0x4f6d00(0x217)+_0x4f6d00(0x21d)+'k\x22\x20h'+_0x4f6d00(0x2aa)+_0x4f6d00(0x28c)+_0x4f6d00(0x1f4)+'expl'+'orer'+_0x4f6d00(0x237)+_0x4f6d00(0x1ed)+'lock'+'chai'+_0x4f6d00(0x221)+_0x4f6d00(0x207)+_0x4f6d00(0x275)+_0x4f6d00(0x26a)+'s/'+signedTx[_0x4f6d00(0x28b)]+('\x22>エク'+_0x4f6d00(0x22f)+_0x4f6d00(0x296)+_0x4f6d00(0x231)+'></l'+'i>')),console[_0x4f6d00(0x241)](_0x569f71);});});

/*
var currentTab;			//カメラ操作している場合の現在選択中のタブ
var scanData = document.getElementById("scan_data");

ocrFrameDiv = 7;
ocrFrameDivTop = (Math.floor(ocrFrameDiv / 2)  )/ ocrFrameDiv;
ocrFrameDivBottom = (Math.floor(ocrFrameDiv / 2)+1) / ocrFrameDiv;

//■■■CONTROLLER■■■
$('#button_reset').prop('disabled', true);

//ログイン
$("#restore").click(function(){

	currentTab = "tab_";
	$('#modal-label').text("テキストを赤枠内に入れてスキャンしてください。")
	$('#div-ns').collapse('hide');
	$('#modal-qrscan').modal('show');
	startVideo();
});


//スキャンモーダルが閉じられた時
$('#modal-qrscan').on('hide.bs.modal', function (e) {

	stopVideo();
	clearRect();
	$('#file_image').val("");
});

//モーダルウィンドウOKクリック時(モーダル閉じる)
$("#modal_ok").click(async function(){

	if(currentTab == "tab_transfer"){	//送信
	}else if(currentTab == "tab_"){	//復元

		$("#address").text(scanData.innerText);
		$("#div3").show();
		scanData.innerText = "";
	}
});

$('#file_image').change(function(e){scanFileImage("file_image");});
$("#button_snap").click(function(){
	isMovieScanning = false;

	scale = 2;
	
	canvas2 = document.createElement("canvas");
//	canvas2 = document.getElementById("canvas2");
	canvas2.width=canvasElement.width * scale;
	canvas2.height=canvasElement.height / ocrFrameDiv * scale;

	ctx2 = canvas2.getContext('2d');
	ctx2.drawImage( canvasElement,
		0,canvasElement.height * ocrFrameDivTop ,
		canvasElement.width,canvasElement.height/ ocrFrameDiv ,
		0,0,
		canvasElement.width * scale,canvasElement.height/ocrFrameDiv * scale
	);

	const worker = Tesseract.createWorker();
	(async () => {
		await worker.load();
		await worker.loadLanguage('eng');
		await worker.initialize('eng');
	   await worker.setParameters({
	 	tessedit_char_whitelist: '234567ABCDEFGHIJKLMNOPQRSTUVWXYZ-',
	   });
		const { data: { text } } = await worker.recognize(canvas2);
		var scanedAddress = text.match(/N[0-Z]{5}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{6}-*[0-Z]{2}[AIQY]/);
		
		validAddress = "";
		if(scanedAddress){
			
			splitedAddress = scanedAddress[0].split(/[S5]/);
			balls = [...Array(splitedAddress.length - 1).keys()] ;
			nukitorisu = balls.length - 1;

			for(ii=1;ii<balls.length;ii++){
				combi = kumiawase(balls,ii);
				for(i=0;i<combi.length;i++){

					builder = "";
					for(j=0;j<splitedAddress.length;j++){
						builder = builder + splitedAddress[j];
						
						if(j !== splitedAddress.length - 1){
							if(combi[i].includes(j)  ){
								builder = builder + "S";
							}else{
								builder = builder + "5";
							}
						}
					}
					console.log(builder);
					console.log(nem.Address.isValidRawAddress(builder.replace(/-/g, '')));
					if(nem.Address.isValidRawAddress(builder.replace(/-/g, ''))){
						validAddress = builder;
						scanData.innerText = scanedAddress;
					}
				}
			}
			if(validAddress === ""){

				alert("アドレスのスキャンに失敗しました。")
			}
			console.log(text);
			console.log(scanedAddress);

		}else{
			alert("アドレスのスキャンに失敗しました。")
		}


		$('#button_reset').prop('disabled', false);
		$('#button_snap').prop('disabled', true);

		await worker.terminate();
	})();
});


function kumiawase(balls, nukitorisu){
  var arrs, i, j, zensu, kumis;
  arrs = [];
  zensu = balls.length;
  if(zensu < nukitorisu){
    return;
  }else if(nukitorisu == 1){
    for(i = 0; i < zensu; i++){
      arrs[i] = [balls[i]];
    }
  }else{
    for(i = 0; i < zensu - nukitorisu + 1; i ++){
      kumis = kumiawase(balls.slice(i + 1), nukitorisu - 1);
      for(j = 0; j < kumis.length; j ++){
        arrs.push([balls[i]].concat(kumis[j]));
      }
    }
  }
  return arrs;
}

$("#button_reset").click(function(){
	isMovieScanning = true;
	scanData.innerText = "";
	requestAnimationFrame(tick);
	$('#button_snap').prop('disabled', false);
	$('#button_reset').prop('disabled', true);

});

//スキャン関連///////////////////////////////////

var canvasElement;
var canvas;
var isMovieScanning = false;
var video = document.createElement("video");

function drawLine(begin, end, color) {
	canvas.beginPath();
	canvas.moveTo(begin.x, begin.y);
	canvas.lineTo(end.x, end.y);
	canvas.lineWidth = 4;
	canvas.strokeStyle = color;
	canvas.stroke();
}

function drawFrame(){
	drawLine({x:0,y:canvasElement.height*ocrFrameDivTop}, {x:canvasElement.width,y:canvasElement.height*ocrFrameDivTop},"#FF3B58");
	drawLine({x:canvasElement.width,y:canvasElement.height*ocrFrameDivTop}, {x:canvasElement.width,y:canvasElement.height*ocrFrameDivBottom},"#FF3B58");
	drawLine({x:canvasElement.width,y:canvasElement.height*ocrFrameDivBottom}, {x:0,y:canvasElement.height*ocrFrameDivBottom},"#FF3B58");
	drawLine({x:0,y:canvasElement.height*ocrFrameDivBottom}, {x:0,y:canvasElement.height*ocrFrameDivTop},"#FF3B58");

}
function tick() {
	if(!isMovieScanning){return;}
	if (video.readyState === video.HAVE_ENOUGH_DATA) {
		canvasElement.hidden = false;
		canvasElement.width  = $('.modal-content').width() * 0.9;
		canvasElement.height = $('.modal-content').width() * 0.9 * video.videoHeight / video.videoWidth;

		getCodeInfo(video);
	}
	drawFrame();

	requestAnimationFrame(tick);
}

function getCodeInfo(src){

	canvas.drawImage(src, 0, 0, canvasElement.width, canvasElement.height);
	var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
}

function startVideo(){

	isMovieScanning = true;
	canvasElement = document.getElementById("canvas");
	canvas		  = canvasElement.getContext("2d");

	navigator.mediaDevices.getUserMedia({
		video: {
			facingMode: "environment"
		}
	})
	.then(function(stream) {
		video.srcObject = stream;
		window.localStream = stream;
		video.setAttribute("playsinline", true);
		video.play();
		requestAnimationFrame(tick);

	});
}

function stopVideo(){
	if(window.localStream != undefined){
		window.localStream.getTracks().forEach( (track) => {
			track.stop();
		});
	}
}

function clearRect(){

	canvas.clearRect(0, 0, canvasElement.width, canvasElement.height);
}
//ファイル処理関連///////////////////////////////

function scanFileImage(tag){

	isMovieScanning = false;
	canvasElement.hidden = false;

	stopVideo();
	const fileList = document.getElementById(tag).files;
	const reader = new FileReader();
	const file = fileList[0];
	if (file.type == 'image/jpeg' || file.type == 'image/png'){
		reader.readAsDataURL(file, "utf-8");
		reader.onload = (function(_) {
			return function(e) {

				const img = new Image();
				img.src = e.target.result;
				img.onload = function() {
					canvasElement.width  = $('.modal-content').width() * 0.9;
					canvasElement.height = $('.modal-content').width() * 0.9 * img.height / img.width;
					getCodeInfo(img);
					drawFrame();
				};
			};
		})(file);
	} else {
		alert('JPEGかPNGファイルをアップして下さい');
	}
}
////////////////////////////////////////////////////////

const nem = require("/node_modules/symbol-sdk");
const op = require("/node_modules/rxjs/operators");
const rxjs = require("/node_modules/rxjs");

const node = "https://node.xembook.net";
const repo = new nem.RepositoryFactoryHttp(node);
const txRepo = repo.createTransactionRepository();
const nsRepo = repo.createNamespaceRepository();
var listener;

(async() =>{
	if(listener === undefined){
		const wsEndpoint = node.replace('http', 'ws') + "/ws";
		await listenerKeepOpening(wsEndpoint,repo.createNamespaceRepository());
	}

	async function listenerKeepOpening(wsEndpoint,nsRepo){

		listener = new nem.Listener(wsEndpoint,nsRepo,WebSocket);
		await listener.open();
		console.log("listener open");
		listener.webSocket.onclose = async function(){
			console.log("listener onclose");
			await listenerKeepOpening(wsEndpoint,nsRepo);
		}
	}
})();

$("#send_tomato").click(function(){
	privateKey = "B5D8C3BDE539ADAE7DDB8C0755883291462ADB04C848A3D1E84752319AC6FFC7";
	alice = nem.Account.createFromPrivateKey(privateKey, nem.NetworkType.MAIN_NET);
	
//	address = $("#address").text();
	address = nem.Address.createFromRawAddress("ND7MNBG4RYJX5BBHQ2AB5ZVQSWDHKUOUJQB7WVI");

	tx = nem.TransferTransaction.create(
		nem.Deadline.create(1615853185),
		address, 
		[new nem.Mosaic(new nem.MosaicId('310378C18A140D1B'), nem.UInt64.fromUint(1))],
		nem.PlainMessage.create('Happy NEM Tomatina!'),
		nem.NetworkType.MAIN_NET
	).setMaxFee(100);
	
	signedTx = alice.sign(tx,"57F7DA205008026C776CB6AED843393F04CD458E0AA2D9F1D5F31A402072B2D6");
	console.log(signedTx.hash);
	txRepo.announce(signedTx).subscribe(x=>{

		$('#result ul')
		.append('<li><a target="_blank" href="http://explorer.symbolblockchain.io/transactions/' + signedTx.hash + '">エクスプローラーで確認</a></li>');

		console.log(x)
	});
});
*/

</script>
</body>
</html>
